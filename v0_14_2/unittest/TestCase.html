        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>TestCase class / unittest Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="unittest" data-type="TestCase">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../unittest.html">unittest</a> &rsaquo; <a href="../unittest/TestCase.html">TestCase</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>TestCase</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>testcase.dart: this file is sourced by unittest.dart. It defines <a class="crossref" href="../unittest/TestCase.html#TestCase">TestCase</a>
and assumes unittest defines the type <a class="crossref" href="../unittest/TestFunction.html">TestFunction</a>.</p>
<p>Summarizes information about a single test case. </p>
<pre class="source">
class TestCase {
 /** Identifier for this test. */
 final int id;

 /** A description of what the test is specifying. */
 final String description;

 /** The setup function to call before the test, if any. */
 Function _setUp;

 Function get setUp =&gt; _setUp;
 set setUp(Function value) =&gt; _setUp = value;

 /** The teardown function to call after the test, if any. */
 Function _tearDown;

 Function get tearDown =&gt; _tearDown;
 set tearDown(Function value) =&gt; _tearDown = value;

 /** The body of the test case. */
 TestFunction test;

 /**
  * Remaining number of callbacks functions that must reach a 'done' state
  * to wait for before the test completes.
  */
 int callbackFunctionsOutstanding;

 /** Error or failure message. */
 String message = '';

 /**
  * One of [PASS], [FAIL], [ERROR], or [null] if the test hasn't run yet.
  */
 String result;

 /** Stack trace associated with this test, or null if it succeeded. */
 String stackTrace;

 /** The group (or groups) under which this test is running. */
 final String currentGroup;

 DateTime startTime;

 Duration runningTime;

 bool enabled = true;

 bool _doneTeardown = false;

 Completer _testComplete;

 TestCase(this.id, this.description, this.test,
          this.callbackFunctionsOutstanding)
 : currentGroup = _currentGroup,
   _setUp = _testSetup,
   _tearDown = _testTeardown;

 bool get isComplete =&gt; !enabled || result != null;

 void _prepTest() {
   _config.onTestStart(this);
   startTime = new DateTime.now();
   runningTime = null;
 }

 void _runTest() {
   _prepTest();
   test();
   if (result == null &amp;&amp; callbackFunctionsOutstanding == 0) {
     pass();
   }
 }

 /**
  * Perform any associated [setUp] function and run the test. Returns
  * a [Future] that can be used to schedule the next test. If the test runs
  * to completion synchronously, or is disabled, we return null, to
  * tell unittest to schedule the next test immediately.
  */
 Future run() {
   if (!enabled) return null;

   result = stackTrace = null;
   message = '';
   _doneTeardown = false;
   var rtn = _setUp == null ? null : _setUp();
   if (rtn is Future) {
     rtn.then(expectAsync1((_) =&gt;_runTest(),
         id: '[Async setUp completion handler]'))
     .catchError((e) {
       _prepTest();
       // Calling error() will result in the tearDown being done.
       // One could debate whether tearDown should be done after
       // a failed setUp. There is no right answer, but doing it
       // seems to be the more conservative approach, because 
       // unittest will not stop at a test failure.
       error("$description: Test setup failed: ${e.error}");
     });
   } else {
     _runTest();
   }
   if (result == null) { // Not complete.
     _testComplete = new Completer();
     return _testComplete.future;
   }
   return null;
 }

 void _notifyComplete() {
   if (_testComplete != null) {
     _testComplete.complete(this);
     _testComplete = null;
   }
 }

 void _complete() {
   if (runningTime == null) {
     // TODO(gram): currently the duration measurement code is blocked
     // by issue 4437. When that is fixed replace the line below with:
     //    runningTime = new DateTime.now().difference(startTime);
     runningTime = new Duration(milliseconds: 0);
   }
   if (!_doneTeardown) {
     _doneTeardown = true;
     if (_tearDown != null) {
       var rtn = _tearDown();
       if (rtn is Future) {
         rtn.then((_) {
           if (result == null) {
             // The test passed. In some cases we will already
             // have set this result (e.g. if the test was async
             // and all callbacks completed). If not, we do it here.
             pass();
           } else {
             // The test has already been marked as pass/fail.
             // Just report the updated result.
             _config.onTestResult(this);
           }
           _notifyComplete();
         })
         .catchError((e) {
           // We don't call fail() as that will potentially result in
           // spurious messages like 'test failed more than once'.
           result = ERROR;
           message = "$description: Test teardown failed: ${e.error}";
           _config.onTestResult(this);
           _notifyComplete();
         });
         return;
       }
     }
   }
   _config.onTestResult(this);
   _notifyComplete();
 }

 void pass() {
   result = PASS;
   _complete();
 }

 void fail(String messageText, [String stack = '']) {
   if (result != null) {
     if (result == PASS) {
       error('Test failed after initially passing: $messageText', stack);
     } else if (result == FAIL) {
       error('Test failed more than once: $messageText', stack);
     }
   } else {
     result = FAIL;
     message = messageText;
     stackTrace = stack;
     _complete();
   }
 }

 void error(String messageText, [String stack = '']) {
   result = ERROR;
   message = messageText;
   stackTrace = stack;
   _complete();
 }
}
</pre>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="TestCase">
<button class="show-code">Code</button>
new <strong>TestCase</strong>(<a href="http://api.dartlang.org/dart_core/int.html">int</a> id, <a href="http://api.dartlang.org/dart_core/String.html">String</a> description, <a href="../unittest/TestFunction.html">TestFunction</a> test, <a href="http://api.dartlang.org/dart_core/int.html">int</a> callbackFunctionsOutstanding) <a class="anchor-link" href="#TestCase"
              title="Permalink to TestCase.TestCase">#</a></h4>
<div class="doc">
<pre class="source">
TestCase(this.id, this.description, this.test,
        this.callbackFunctionsOutstanding)
: currentGroup = _currentGroup,
 _setUp = _testSetup,
 _tearDown = _testTeardown;
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="callbackFunctionsOutstanding">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/int.html">int</a>         <strong>callbackFunctionsOutstanding</strong> <a class="anchor-link"
            href="#callbackFunctionsOutstanding"
            title="Permalink to TestCase.callbackFunctionsOutstanding">#</a>
        </h4>
        <div class="doc">
<pre class="source">
callbackFunctionsOutstanding
</pre>
</div>
</div>
<div class="field"><h4 id="currentGroup">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>currentGroup</strong> <a class="anchor-link"
            href="#currentGroup"
            title="Permalink to TestCase.currentGroup">#</a>
        </h4>
        <div class="doc">
<pre class="source">
currentGroup
</pre>
</div>
</div>
<div class="field"><h4 id="description">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>description</strong> <a class="anchor-link"
            href="#description"
            title="Permalink to TestCase.description">#</a>
        </h4>
        <div class="doc">
<pre class="source">
description
</pre>
</div>
</div>
<div class="field"><h4 id="enabled">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/bool.html">bool</a>         <strong>enabled</strong> <a class="anchor-link"
            href="#enabled"
            title="Permalink to TestCase.enabled">#</a>
        </h4>
        <div class="doc">
<pre class="source">
enabled = true
</pre>
</div>
</div>
<div class="field"><h4 id="id">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/int.html">int</a>         <strong>id</strong> <a class="anchor-link"
            href="#id"
            title="Permalink to TestCase.id">#</a>
        </h4>
        <div class="doc">
<pre class="source">
id
</pre>
</div>
</div>
<div class="field"><h4 id="isComplete">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/bool.html">bool</a>         <strong>isComplete</strong> <a class="anchor-link"
            href="#isComplete"
            title="Permalink to TestCase.isComplete">#</a>
        </h4>
        <div class="doc">
<pre class="source">
bool get isComplete =&gt; !enabled || result != null;
</pre>
</div>
</div>
<div class="field"><h4 id="message">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>message</strong> <a class="anchor-link"
            href="#message"
            title="Permalink to TestCase.message">#</a>
        </h4>
        <div class="doc">
<pre class="source">
message = ''
</pre>
</div>
</div>
<div class="field"><h4 id="result">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>result</strong> <a class="anchor-link"
            href="#result"
            title="Permalink to TestCase.result">#</a>
        </h4>
        <div class="doc">
<pre class="source">
result
</pre>
</div>
</div>
<div class="field"><h4 id="runningTime">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Duration.html">Duration</a>         <strong>runningTime</strong> <a class="anchor-link"
            href="#runningTime"
            title="Permalink to TestCase.runningTime">#</a>
        </h4>
        <div class="doc">
<pre class="source">
runningTime
</pre>
</div>
</div>
<div class="field"><h4 id="setUp">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Function.html">Function</a>         <strong>setUp</strong> <a class="anchor-link"
            href="#setUp"
            title="Permalink to TestCase.setUp">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Function get setUp =&gt; _setUp;
</pre>
<pre class="source">
set setUp(Function value) =&gt; _setUp = value;
</pre>
</div>
</div>
<div class="field"><h4 id="stackTrace">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>stackTrace</strong> <a class="anchor-link"
            href="#stackTrace"
            title="Permalink to TestCase.stackTrace">#</a>
        </h4>
        <div class="doc">
<pre class="source">
stackTrace
</pre>
</div>
</div>
<div class="field"><h4 id="startTime">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/DateTime.html">DateTime</a>         <strong>startTime</strong> <a class="anchor-link"
            href="#startTime"
            title="Permalink to TestCase.startTime">#</a>
        </h4>
        <div class="doc">
<pre class="source">
startTime
</pre>
</div>
</div>
<div class="field"><h4 id="tearDown">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Function.html">Function</a>         <strong>tearDown</strong> <a class="anchor-link"
            href="#tearDown"
            title="Permalink to TestCase.tearDown">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Function get tearDown =&gt; _tearDown;
</pre>
<pre class="source">
set tearDown(Function value) =&gt; _tearDown = value;
</pre>
</div>
</div>
<div class="field"><h4 id="test">
<button class="show-code">Code</button>
<a href="../unittest/TestFunction.html">TestFunction</a>         <strong>test</strong> <a class="anchor-link"
            href="#test"
            title="Permalink to TestCase.test">#</a>
        </h4>
        <div class="doc">
<pre class="source">
test
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="error">
<button class="show-code">Code</button>
void <strong>error</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> messageText, [<a href="http://api.dartlang.org/dart_core/String.html">String</a> stack = '']) <a class="anchor-link" href="#error"
              title="Permalink to TestCase.error">#</a></h4>
<div class="doc">
<pre class="source">
void error(String messageText, [String stack = '']) {
 result = ERROR;
 message = messageText;
 stackTrace = stack;
 _complete();
}
</pre>
</div>
</div>
<div class="method"><h4 id="fail">
<button class="show-code">Code</button>
void <strong>fail</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> messageText, [<a href="http://api.dartlang.org/dart_core/String.html">String</a> stack = '']) <a class="anchor-link" href="#fail"
              title="Permalink to TestCase.fail">#</a></h4>
<div class="doc">
<pre class="source">
void fail(String messageText, [String stack = '']) {
 if (result != null) {
   if (result == PASS) {
     error('Test failed after initially passing: $messageText', stack);
   } else if (result == FAIL) {
     error('Test failed more than once: $messageText', stack);
   }
 } else {
   result = FAIL;
   message = messageText;
   stackTrace = stack;
   _complete();
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="pass">
<button class="show-code">Code</button>
void <strong>pass</strong>() <a class="anchor-link" href="#pass"
              title="Permalink to TestCase.pass">#</a></h4>
<div class="doc">
<pre class="source">
void pass() {
 result = PASS;
 _complete();
}
</pre>
</div>
</div>
<div class="method"><h4 id="run">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_async/Future.html">Future</a> <strong>run</strong>() <a class="anchor-link" href="#run"
              title="Permalink to TestCase.run">#</a></h4>
<div class="doc">
<p>Perform any associated <a class="crossref" href="../unittest/TestCase.html#setUp">setUp</a> function and run the test. Returns
a <code>Future</code> that can be used to schedule the next test. If the test runs
to completion synchronously, or is disabled, we return null, to
tell unittest to schedule the next test immediately.</p>
<pre class="source">
Future run() {
 if (!enabled) return null;

 result = stackTrace = null;
 message = '';
 _doneTeardown = false;
 var rtn = _setUp == null ? null : _setUp();
 if (rtn is Future) {
   rtn.then(expectAsync1((_) =&gt;_runTest(),
       id: '[Async setUp completion handler]'))
   .catchError((e) {
     _prepTest();
     // Calling error() will result in the tearDown being done.
     // One could debate whether tearDown should be done after
     // a failed setUp. There is no right answer, but doing it
     // seems to be the more conservative approach, because 
     // unittest will not stop at a test failure.
     error("$description: Test setup failed: ${e.error}");
   });
 } else {
   _runTest();
 }
 if (result == null) { // Not complete.
   _testComplete = new Completer();
   return _testComplete.future;
 }
 return null;
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
